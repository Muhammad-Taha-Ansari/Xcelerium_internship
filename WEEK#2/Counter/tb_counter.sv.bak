`timescale 1ns/1ps

module tb_counter ();
wire [31:0] count;
reg clk;
reg rst_n , up_dn , en;

counter dut (count, clk, rst_n, en, up_dn);

initial clk = 0;
always #5 clk = ~clk;

initial begin
integer i;
integer pass_count = 0;
integer fail_count = 0;
logic [31:0] expected;

rst_n = 0; en = 0; up_dn = 1; expected = 0;
#10
rst_n = 1;

$display("------STARTING DIRECTED TEST------");

if (count ! == 0) begin
$display("FAIL: RESET FAILED, count = %0d", count);
fail_count ++;
end 
else pass_count++;

en = 1; up_d = 1;
for (i=0; i<5; i++) begin
#10
expected = expected + 1;
if (count ! == expected) begin
$display("FAIL: Up count mismatch at cycle %0d: got=%0d, expected=%0d", i, count, expected);
fail_count++;
end 
else pass_count++;
end 

up_dn = 0;
for (i = 0; i < 3; i++) begin
#10;
expected = expected - 1;
if (count !== expected) begin
$display("FAIL: Down count mismatch at cycle %0d: got=%0d, expected=%0d", i, count, expected);
fail_count++;
end 
else pass_count++;
end

en = 0;
#20;
if (count !== expected) begin
$display("FAIL: Hold mismatch: got=%0d, expected=%0d", count, expected);
fail_count++;
end else pass_count++;

$display("_____Starting Randomized Test_____");
for (i = 0; i < 10; i++) begin
en = $urandom_range(0,1);
up_dn = $urandom_range(0,1);
#10;
if (en && up_dn)
expected = expected + 1;
else if (en && !up_dn)
expected = expected - 1;
if (count !== expected) begin
$display("FAIL: Random test mismatch at cycle %0d: got=%0d, expected=%0d, en=%0b, up_dn=%0b",
i, count, expected, en, up_dn);
fail_count++;
end 
else pass_count++;
end

// Summary
$display("_____Test Complete_____");
$display("Passed: %0d, Failed: %0d", pass_count, fail_count);
$finish;
end
endmodule