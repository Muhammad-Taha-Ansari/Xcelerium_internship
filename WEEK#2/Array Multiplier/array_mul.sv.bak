module array_mul(
    output logic [15:0] P,
    input logic [7:0] A,
    input logic [7:0] B,
    input logic clk,
    input logic rst,
    input logic start
);
    logic [7:0] a_reg, b_reg;
    logic [31:0] sum_reg, next_sum;
    logic [3:0] count;
    logic done;
    logic [31:0] pp_shifted;

    // 32-bit adder instance
    Adder32Bit add_inst(
        .a(sum_reg),
        .b(pp_shifted),
        .cin(1'b0),
        .sum(next_sum),
        .cout()
    );

    always_ff @(posedge clk or posedge rst) begin
        if (rst) begin
            a_reg   <= 0;
            b_reg   <= 0;
            sum_reg <= 0;
            count   <= 0;
            P       <= 0;
            done    <= 0;
        end else if (start) begin
            if (count == 0) begin
                // Load inputs on first cycle
                a_reg   <= A;
                b_reg   <= B;
                sum_reg <= 0;
                count   <= 1;
                done    <= 0;
            end else if (count <= 8) begin
                // Generate partial product (shifted multiplicand)
                pp_shifted = {24'b0, a_reg} << (count-1);

                // Add partial product using 32-bit adder
                sum_reg <= next_sum;

                count <= count + 1;
            end else begin
                // Multiplication complete
                P    <= sum_reg[15:0];
                done <= 1;
            end
        end
    end
endmodule
